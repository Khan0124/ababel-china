# ุชุตุญูุญ ููุทู ุญุณุงุจ ุฃุฑุตุฏุฉ ุงูุนููุงุก

## ุงููุดููุฉ ุงูุณุงุจูุฉ
ูุงู ุงููุธุงู ูุญุณุจ ุฃุฑุตุฏุฉ ุงูุนููุงุก ุจุทุฑููุฉ ุฎุงุทุฆุฉ ุญูุซ ูุงูุช ุงูููุงุชูุฑ ุชุธูุฑ ูุฑุตูุฏ ูุงุฆุถ ููุนููู ุจุฏูุงู ูู ุฏูู ูุณุชุญู ุนููู.

## ุงููุธุงู ุงููุญุงุณุจู ุงูุฌุฏูุฏ (ุงูุงุญุชุฑุงูู)

### ุงููุงุนุฏุฉ ุงูุฃุณุงุณูุฉ:
```
ุฑุตูุฏ ุงูุนููู = ุงููุฏููุนุงุช ุงููุณุชููุฉ - ุงููุจูุนุงุช ูุงููุตุงุฑูู
```

### ุชูุณูุฑ ุงูุฃุฑุตุฏุฉ:
- **ุฑุตูุฏ ุณุงูุจ (-)**  = ุฏูู ุนูู ุงูุนููู (ุงูุนููู ูุฏูู ููุดุฑูุฉ)
- **ุฑุตูุฏ ููุฌุจ (+)**  = ุฑุตูุฏ ูุงุฆุถ ููุนููู (ุงูุดุฑูุฉ ุชุฏูู ููุนููู)
- **ุฑุตูุฏ ุตูุฑ (0)**    = ูุง ููุฌุฏ ุฏูู ุนูู ุงูุนููู ุฃู ูู

### ุฃููุงุน ุงููุนุงููุงุช:
- **ุงููุจูุนุงุช** (expense/transfer): ูุซู ุดุฑุงุก ุจุถุงุนุฉุ ุดุญูุ ุชุญููู ููุชุจ
  - ุชุฒูุฏ ุงูุฏูู ุนูู ุงูุนููู (ุชููู ุงูุฑุตูุฏ)
- **ุงููุฏููุนุงุช** (income): ุงูุฃููุงู ุงููุณุชููุฉ ูู ุงูุนููู
  - ุชููู ุงูุฏูู ุนูู ุงูุนููู (ุชุฒูุฏ ุงูุฑุตูุฏ)

## ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ุชุญุฏูุซ Transaction Model
- ุชุนุฏูู ุฏุงูุฉ `updateClientBalance()`
- ุชุนุฏูู ุฏุงูุฉ `getClientBalancesByCurrency()`

### 2. ุชุญุฏูุซ Report Controller  
- ุชุตุญูุญ ุงุณุชุนูุงู ุชูุงุฑูุฑ ุงูุนููุงุก

### 3. ุงูุญูุงุธ ุนูู Helper Functions
- `formatBalance()` - ุชุนุฑุถ ุงูุฑุตูุฏ ุจุงูุดูู ุงูุตุญูุญ
- `getOutstandingAmount()` - ุชุญุณุจ ุงููุจูุบ ุงููุณุชุญู ููุฏูุน
- `getBalanceType()` - ุชุญุฏุฏ ููุน ุงูุฑุตูุฏ

## ููููุฉ ุชุทุจูู ุงูุชุตุญูุญ

### ุงูุทุฑููุฉ ุงูุฃููู: ุชุดุบูู SQL Script
```bash
mysql -u username -p database_name < migrations/fix_balance_calculation.sql
```

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุชุดุบูู PHP Script
```bash
cd /www/wwwroot/khxtech.xyz
php fix_client_balances.php
```

## ูุซุงู ุนูู ุงูุญุณุงุจ

### ุนููู ูู ูุนุงููุงุช:
- ูุงุชูุฑุฉ ุจุถุงุนุฉ: ยฅ1000 (ููุน expense)
- ุฏูุนุฉ ูุณุชููุฉ: ยฅ600 (ููุน income)

### ุงูุญุณุงุจ:
```
ุงูุฑุตูุฏ = ุงููุฏููุนุงุช - ุงููุจูุนุงุช
       = ยฅ600 - ยฅ1000
       = -ยฅ400
```

### ุงููุชูุฌุฉ:
- ุงูุฑุตูุฏ: -ยฅ400 (ุณุงูุจ)
- ุงููุนูู: ุงูุนููู ูุฏูู ููุดุฑูุฉ ยฅ400
- ุงููุจูุบ ุงููุณุชุญู ููุฏูุน: ยฅ400

## ุงูุชุญูู ูู ุตุญุฉ ุงูุชุทุจูู

ุจุนุฏ ุชุดุบูู ุงูุชุตุญูุญุ ุชุฃูุฏ ูู:
1. ุงูููุงุชูุฑ ุงูุฌุฏูุฏุฉ ุชุธูุฑ ูุฏูู ุนูู ุงูุนููู
2. ุงููุฏููุนุงุช ุชููู ุงูุฏูู
3. ุงูุนุฑุถ ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุตุญูุญ
4. ุงูุชูุงุฑูุฑ ุชูุธูุฑ ุงูุฃุฑุตุฏุฉ ุงูุตุญูุญุฉ

## ููุงุญุธุงุช ูููุฉ

- โ๏ธ ุชุฃูุฏ ูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุงูุชุทุจูู
- ๐ ุงุฎุชุจุฑ ุงููุธุงู ุจุนูุงูุฉ ุจุนุฏ ุงูุชุทุจูู
- ๐ ุฑุงุฌุน ุชูุงุฑูุฑ ุงูุนููุงุก ููุชุฃูุฏ ูู ุตุญุฉ ุงูุฃุฑุตุฏุฉ
- ๐ก ุงููุธุงู ุงูุฌุฏูุฏ ูุชูุงูู ูุน ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ ุงูุนุงูููุฉ